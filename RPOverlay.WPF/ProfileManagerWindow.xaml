<Window x:Class="RPOverlay.WPF.ProfileManagerWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="Profilhantering"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
        ResizeMode="NoResize"
        Width="500"
        Height="600"
        WindowStartupLocation="CenterScreen"
        ShowInTaskbar="False">
    <Border Background="#DD1E1E1E"
            CornerRadius="12"
            BorderBrush="#FF3F3F3F"
            BorderThickness="1">
        <Grid Margin="24">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Header -->
            <Grid Grid.Row="0" Margin="0,0,0,20">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <StackPanel Grid.Column="0">
                    <TextBlock Text="Profilhantering"
                               FontSize="24"
                               FontWeight="SemiBold"
                               Foreground="White"/>
                    <TextBlock Text="Hantera dina rollspelsprofiler"
                               Margin="0,4,0,0"
                               Foreground="#FFAAAAAA"
                               FontSize="12"/>
                </StackPanel>

                <Button Grid.Column="1"
                        Content="×"
                        Click="Close_Click"
                        Width="32"
                        Height="32"
                        FontSize="24"
                        FontWeight="Light"
                        Background="Transparent"
                        Foreground="#FFAAAAAA"
                        BorderThickness="0"
                        Cursor="Hand"
                        VerticalAlignment="Top">
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="Background" Value="Transparent"/>
                            <Setter Property="Foreground" Value="#FFAAAAAA"/>
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="Button">
                                        <Border Background="{TemplateBinding Background}"
                                                CornerRadius="4">
                                            <ContentPresenter HorizontalAlignment="Center"
                                                            VerticalAlignment="Center"/>
                                        </Border>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                            <Style.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="#22FFFFFF"/>
                                    <Setter Property="Foreground" Value="White"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                </Button>
            </Grid>

            <!-- Profile List -->
            <Border Grid.Row="1"
                    Background="#11FFFFFF"
                    CornerRadius="8"
                    Padding="8"
                    Margin="0,0,0,16">
                <ScrollViewer VerticalScrollBarVisibility="Auto"
                              HorizontalScrollBarVisibility="Disabled">
                    <ItemsControl x:Name="ProfilesList">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border x:Name="ProfileBorder"
                                        Background="#22FFFFFF"
                                        BorderBrush="Transparent"
                                        BorderThickness="2"
                                        CornerRadius="6"
                                        Margin="0,0,0,8"
                                        Padding="12">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <!-- Active indicator -->
                                        <Border Grid.Column="0"
                                                x:Name="ActiveIndicator"
                                                Width="4"
                                                Height="32"
                                                Background="#FF2ECC71"
                                                CornerRadius="2"
                                                Margin="0,0,12,0"
                                                VerticalAlignment="Center"
                                                Visibility="Collapsed"/>

                                        <StackPanel Grid.Column="1">
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock Text="{Binding Name}"
                                                           FontSize="14"
                                                           FontWeight="Medium"
                                                           Foreground="White"
                                                           VerticalAlignment="Center"/>
                                                <Border x:Name="ActiveBadge"
                                                        Background="#FF2ECC71"
                                                        CornerRadius="3"
                                                        Padding="6,2"
                                                        Margin="8,0,0,0"
                                                        Visibility="Collapsed">
                                                    <TextBlock Text="AKTIV"
                                                               FontSize="9"
                                                               FontWeight="Bold"
                                                               Foreground="White"/>
                                                </Border>
                                            </StackPanel>
                                            <TextBlock Foreground="#FF888888"
                                                       FontSize="10"
                                                       Margin="0,2,0,0">
                                                <Run Text="Senast använd: "/>
                                                <Run Text="{Binding LastUsedDate, StringFormat='{}{0:yyyy-MM-dd HH:mm}'}"/>
                                            </TextBlock>
                                        </StackPanel>

                                        <StackPanel Grid.Column="2"
                                                    Orientation="Horizontal"
                                                    VerticalAlignment="Center">
                                            <Button Content="Aktivera"
                                                    x:Name="ActivateButton"
                                                    Click="ActivateProfile_Click"
                                                    Tag="{Binding Id}"
                                                    Margin="0,0,8,0"
                                                    Padding="12,6"
                                                    Background="#FF2F9DFF"
                                                    Foreground="White"
                                                    BorderThickness="0"
                                                    FontSize="11"
                                                    Cursor="Hand">
                                                <Button.Style>
                                                    <Style TargetType="Button">
                                                        <Setter Property="Background" Value="#FF2F9DFF"/>
                                                        <Setter Property="Template">
                                                            <Setter.Value>
                                                                <ControlTemplate TargetType="Button">
                                                                    <Border Background="{TemplateBinding Background}"
                                                                            CornerRadius="4"
                                                                            Padding="{TemplateBinding Padding}">
                                                                        <ContentPresenter HorizontalAlignment="Center"
                                                                                        VerticalAlignment="Center"/>
                                                                    </Border>
                                                                </ControlTemplate>
                                                            </Setter.Value>
                                                        </Setter>
                                                        <Style.Triggers>
                                                            <Trigger Property="IsMouseOver" Value="True">
                                                                <Setter Property="Background" Value="#FF4AADFF"/>
                                                            </Trigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </Button.Style>
                                            </Button>

                                            <Button Content="🗑"
                                                    Click="DeleteProfile_Click"
                                                    Tag="{Binding Id}"
                                                    Width="32"
                                                    Height="32"
                                                    Background="Transparent"
                                                    Foreground="#FFFF5555"
                                                    BorderThickness="0"
                                                    FontSize="14"
                                                    Cursor="Hand"
                                                    ToolTip="Ta bort profil">
                                                <Button.Style>
                                                    <Style TargetType="Button">
                                                        <Setter Property="Background" Value="Transparent"/>
                                                        <Setter Property="Template">
                                                            <Setter.Value>
                                                                <ControlTemplate TargetType="Button">
                                                                    <Border Background="{TemplateBinding Background}"
                                                                            CornerRadius="4">
                                                                        <ContentPresenter HorizontalAlignment="Center"
                                                                                        VerticalAlignment="Center"/>
                                                                    </Border>
                                                                </ControlTemplate>
                                                            </Setter.Value>
                                                        </Setter>
                                                        <Style.Triggers>
                                                            <Trigger Property="IsMouseOver" Value="True">
                                                                <Setter Property="Background" Value="#22FF5555"/>
                                                            </Trigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </Button.Style>
                                            </Button>
                                        </StackPanel>
                                    </Grid>
                                </Border>
                                <DataTemplate.Triggers>
                                    <DataTrigger Binding="{Binding IsActive}" Value="True">
                                        <Setter TargetName="ActiveIndicator" Property="Visibility" Value="Visible"/>
                                        <Setter TargetName="ActiveBadge" Property="Visibility" Value="Visible"/>
                                        <Setter TargetName="ProfileBorder" Property="BorderBrush" Value="#FF2ECC71"/>
                                        <Setter TargetName="ProfileBorder" Property="Background" Value="#332ECC71"/>
                                        <Setter TargetName="ActivateButton" Property="Visibility" Value="Collapsed"/>
                                    </DataTrigger>
                                </DataTemplate.Triggers>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
            </Border>

            <!-- Create New Profile -->
            <Grid Grid.Row="2" Margin="0,0,0,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBox x:Name="NewProfileNameTextBox"
                         Grid.Column="0"
                         Background="#22FFFFFF"
                         Foreground="White"
                         CaretBrush="White"
                         BorderBrush="#FF3F3F3F"
                         BorderThickness="1"
                         Padding="10,8"
                         FontSize="13"
                         Margin="0,0,8,0"
                         Height="36"
                         VerticalContentAlignment="Center">
                    <TextBox.Resources>
                        <VisualBrush x:Key="HelpBrush" TileMode="None" Opacity="0.5" Stretch="None" AlignmentX="Left">
                            <VisualBrush.Visual>
                                <TextBlock Text="Ange profilnamn..." 
                                           FontSize="13" 
                                           Foreground="#FFAAAAAA"
                                           Margin="12,0,0,0"/>
                            </VisualBrush.Visual>
                        </VisualBrush>
                    </TextBox.Resources>
                    <TextBox.Style>
                        <Style TargetType="TextBox">
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="TextBox">
                                        <Border Background="{TemplateBinding Background}"
                                                BorderBrush="{TemplateBinding BorderBrush}"
                                                BorderThickness="{TemplateBinding BorderThickness}"
                                                CornerRadius="6">
                                            <Grid>
                                                <ScrollViewer x:Name="PART_ContentHost"
                                                            Margin="{TemplateBinding Padding}"/>
                                                <Rectangle x:Name="WatermarkRect" 
                                                          Fill="{StaticResource HelpBrush}" 
                                                          Visibility="Collapsed"/>
                                            </Grid>
                                        </Border>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="Text" Value="">
                                                <Setter TargetName="WatermarkRect" Property="Visibility" Value="Visible"/>
                                            </Trigger>
                                            <Trigger Property="Text" Value="{x:Null}">
                                                <Setter TargetName="WatermarkRect" Property="Visibility" Value="Visible"/>
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </TextBox.Style>
                </TextBox>

                <Button Grid.Column="1"
                        Content="Skapa ny profil"
                        Click="CreateProfile_Click"
                        Padding="14,8"
                        Height="36"
                        Background="#FF2ECC71"
                        Foreground="White"
                        BorderThickness="0"
                        FontSize="13"
                        FontWeight="Medium"
                        Cursor="Hand">
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="Background" Value="#FF2ECC71"/>
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="Button">
                                        <Border Background="{TemplateBinding Background}"
                                                CornerRadius="6"
                                                Padding="{TemplateBinding Padding}">
                                            <ContentPresenter HorizontalAlignment="Center"
                                                            VerticalAlignment="Center"/>
                                        </Border>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                            <Style.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="#FF3FDD82"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                </Button>
            </Grid>
        </Grid>
    </Border>
</Window>
